{% extends 'base_generic.html' %}
{% load static %}
{% block content %}

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9; /* 페이지 배경색 */
    }

    /*.container_01 {
        padding: 20px;
        border-radius: 10px;
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }*/

    h1 {
        color: #CF6764; /* 제목 색상 */
        text-align: center;
        margin-bottom: 20px;
        font-size: 3rem; /* 제목 크기 키움 */
    }

    .gallery h2,
    h2 {
        color: #CF6764; /* 하위 제목 색상 */
        margin-top: 30px;
    }

    .search-container {
        display: flex;
        flex-direction: column;
        align-items: center; /* 중앙 정렬 */
        margin: 20px 0; /* 위아래 여백 추가 */
    }

    .input-group {
        max-width: 600px; /* 최대 너비 설정 */
        width: 100%; /* 전체 너비 사용 */
    }

        .input-group select,
        .input-group input,
        .input-group button {
            margin-right: 10px;
        }

        .input-group select {
            border: 1px solid #CF6764;
            border-radius: 5px;
            padding: 10px;
            flex: 1; /* flex-grow 설정 */
        }

        .input-group input {
            border: 1px solid #CF6764;
            border-radius: 5px;
            padding: 10px;
            flex: 2; /* flex-grow 설정 */
        }

        .input-group button {
            background-color: #CF6764; /* 버튼 색상 변경 */
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
        }

    .table-wrapper {
        display: flex;
        justify-content: center; /* 부모 요소에서 중앙 정렬 */
        width: 100%;
    }

    .input-group button:hover {
        background-color: #BF5A5A; /* 버튼 호버 색상 */
    }

    .table {
        width: 70%;
        margin-top: 20px;
        margin-left: auto;
        margin-right: auto; /* 테이블 중앙 정렬 */
        text-align: center; /* 테이블 내용 중앙 정렬 */
    }

        .table th {
            background-color: #CF6764;
            color: white;
        }

        .table td {
            border-bottom: 1px solid #ddd; /* 테두리 */
        }

    .pagination {
        display: flex;
        justify-content: center; /* 중앙 정렬 */
        margin-top: 20px;
    }

        .pagination a {
            color: #CF6764;
            margin: 0 10px;
            text-decoration: none;
        }

            .pagination a:hover {
                text-decoration: underline;
            }

    .card {
        border: none;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
        height: 250px;
        display: flex;
        flex-direction: column;
        transition: none; /* 카드에 이펙트 제거 */
    }

    .card-img-top {
        width: 250px;
        height: 110px; /* 이미지 높이를 줄임 */
        object-fit: contain; /* 이미지 비율 유지하며 잘라내기 */
        margin-bottom: 0.1rem;
    }

    .card-body {
        text-align: left;
        padding: 0.8rem; /* 패딩 조정 */
    }

    .card-title {
        font-size: 2rem; /* 제목 글씨 크기 증가 */
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .card-text {
        font-size: 2rem; /* 본문 설명 글씨 크기 조정 */
        color: #666; /* 설명 글 색상 */
        margin-bottom: 0.1rem;
    }

    .card-footer {
        font-size: 1.4rem; /* 하단 정보 글씨 크기 증가 */
        color: #888;
        padding: 0.9rem 0;
    }

        .card-footer small {
            display: block;
        }

    .card-link {
        color: inherit;
        text-decoration: none;
    }

        .card-link:hover {
            text-decoration: none; /* 카드 링크의 hover 이펙트 제거 */
        }
</style>

<div class="container_01 hot-posts">
    <h1 style="font-weight: bold; text-decoration: underline;">Hot 게시판</h1>

    {% if not request.GET.q %}
    <!-- 추천수가 가장 높은 3개의 게시글 갤러리 -->
    <div class="gallery">
        <h2>추천 게시글</h2>
        <div class="row d-flex justify-content-center">
            {% for post in top_posts %}
            <div class="col-md-4 d-flex">
                <a href="{% url 'post_detail' post.id %}" class="card mb-3 card-link" style="text-decoration: none;">
                    <div class="card">
                        {% if post.image %}
                        <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}">
                        {% else %}
                        <img src="/media/default_image.jpg" class="card-img-top" alt="기본 이미지">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ post.title }}</h5>
                            <p class="card-text">{{ post.content|truncatewords:15 }}</p>
                        </div>
                        <div class="card-footer">
                            <small>{{ post.created_at|date:"Y.m.d" }} | 추천수: {{ post.likes }} | 작성자: {{ post.author.username }}</small>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12">
                <p>추천 게시글이 없습니다.</p>
            </div>
            {% endfor %}
        </div>
    </div>

    {% endif %}

    <!-- 추천수가 20개 이상인 게시글 목록 -->
    <h2 style="text-align: center;">HOT 게시글</h2>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">구분</th>
                <th scope="col">제목</th>
                <th scope="col">작성자</th>
                <th scope="col">추천</th>
                <th scope="col">조회수</th> <!-- 조회수 추가 -->
                <th scope="col">작성일</th>
            </tr>
        </thead>
        <tbody>
            {% if recommended_posts %}
            {% for post in recommended_posts %}
            <tr>
                <td>{{ forloop.counter }}</td> <!-- 구분 (순번) -->
                <td>
                    <a href="{% url 'post_detail' post.id %}">{{ post.title }}</a>
                    {% if post.image %}
                    <i class="fas fa-image" style="color: #CF6764; margin-left: 5px;" title="이미지 첨부됨"></i>
                    {% endif %}
                </td>
                <td>{{ post.author.username }}</td>
                <td>{{ post.likes }}</td>
                <td>{{ post.views }}</td> <!-- 조회수 표시 -->
                <td>{{ post.created_at|date:"Y.m.d" }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="6" class="text-center">게시글이 없습니다.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <div class="search-container text-center">
        <h2>게시글 검색</h2>
        <form method="GET" action="{% url 'hothot' %}">
            <div class="input-group">
                <select name="search_type" class="form-select">
                    <option value="title">제목</option>
                    <option value="content">내용</option>
                    <option value="author">작성자</option>
                </select>
                <input type="text" name="q" class="form-control" placeholder="검색어 입력" aria-label="Search">
                <button class="btn btn-outline-secondary" type="submit">검색</button>
            </div>
        </form>
    </div>

    <!-- 페이지 네비게이션 -->
    <div class="pagination">
        {% if recommended_posts.has_previous %}
        <a href="?page={{ recommended_posts.previous_page_number }}">이전</a>
        {% endif %}
        <span>Page {{ recommended_posts.number }} of {{ recommended_posts.paginator.num_pages }}</span>
        {% if recommended_posts.has_next %}
        <a href="?page={{ recommended_posts.next_page_number }}">다음</a>
        {% endif %}
    </div>
</div>
{% endblock %}
