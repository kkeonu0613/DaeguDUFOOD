{% extends 'base_generic.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"> <!-- Roboto 글꼴 추가 -->

<div class="content-review">
    <h1 class="review-title">리뷰 목록</h1>
    {% if reviews %}
    <ul class="review-list">
        {% for review in reviews %}
        <li class="review-item">
            <div class="user-info">
                <img src="{{ review.author.profile.profile_picture.url }}" alt="{{ review.author.username }}의 프로필 사진" class="profile-pic">
                <div class="user-details">
                    <strong>{{ review.author }}</strong>
                    <span class="review-date">{{ review.created_date|date:"Y-m-d" }}</span>
                </div>
            </div>
            <p class="review-text">{{ review.text }}</p>
            <p class="review-rating">평점: <strong>{{ review.rating }}</strong></p>
            {% if review.author == request.user %}
                <div class="review-actions">
                    <a href="{% url 'edit_review' review.id %}" class="link">수정</a>  <!-- 수정 링크 -->
                    <a href="#" onclick="confirmDelete({{ review.id }}); return false;" class="link">삭제</a>  <!-- 삭제 링크 -->
                </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p class="no-reviews">작성된 리뷰가 존재하지 않습니다.</p>
    {% endif %}
    <div class="links">
        <a href="{% url 'create_review' restaurant.id %}" class="primary_review">리뷰 작성</a>
        <a href="{% url 'restaurant_view' restaurant.id %}" class="secondary_review">식당 페이지로 돌아가기</a>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <p>정말 이 리뷰를 삭제하시겠습니까?</p>
        <button id="confirmDeleteButton" class="btn btn-danger">삭제</button>
        <button onclick="closeModal();" class="btn btn-secondary">취소</button>
    </div>
</div>

<script>
    let reviewIdToDelete;

    function confirmDelete(reviewId) {
        reviewIdToDelete = reviewId;
        document.getElementById('deleteModal').style.display = 'flex'; // 모달을 보이게 설정
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none'; // 모달 숨기기
    }

    document.getElementById('confirmDeleteButton').onclick = function() {
        // 삭제 요청 URL 설정
        window.location.href = "{% url 'delete_review' 0 %}".replace('0', reviewIdToDelete);
    };
</script>

<style>
    /* 기본 글꼴 설정 */
    body {
        font-family: 'Roboto', sans-serif; /* Roboto 글꼴 적용 */
    }

    /* 리뷰 목록 컨테이너 스타일 */
    .content-review {
        max-width: 800px;
        margin: 20px auto;
        padding: 30px;
        background-color: #ffffff; /* 배경색 변경 */
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .review-title {
        text-align: center;
        color: #333;
        margin-bottom: 30px; /* 제목 아래 여백 추가 */
        font-size: 2.5em; /* 제목 크기 조정 */
        font-weight: bold; /* 제목 두껍게 설정 */
    }

    .review-list {
        list-style: none;
        padding: 0;
    }

    .review-item {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 20px; /* 패딩 추가 */
        margin-bottom: 20px; /* 항목 간격 추가 */
        background-color: #f8f8f8; /* 리뷰 항목 배경색 */
        transition: transform 0.3s; /* 부드러운 효과 추가 */
    }

    .review-item:hover {
        transform: translateY(-5px); /* 마우스 오버 시 약간 상승 효과 */
    }

    .user-info {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .profile-pic {
        width: 60px; /* 프로필 사진 크기 조정 */
        height: 60px;
        border-radius: 50%;
        margin-right: 15px;
        border: 3px solid #CF6764; /* 테두리 색상 */
    }

    .user-details {
        display: flex;
        flex-direction: column;
    }

    .review-date {
        color: #777;
        font-size: 0.9em;
    }

    .review-text {
        font-size: 1.1em;
        margin: 10px 0;
        color: #444;
        line-height: 1.6; /* 줄 간격 조정 */
    }

    .review-rating {
        font-weight: bold;
        color: #CF6764; /* 평점 색상 */
    }

    .review-actions {
        margin-top: 10px;
    }

    .link {
        text-decoration: underline; /* 링크에 밑줄 추가 */
        color: #CF6764; /* 링크 색상 수정 */
        margin-right: 10px;
        font-weight: normal; /* 글씨체를 기본으로 유지 */
    }

    .content-review .primary_review {
        display: inline-block;
        padding: 10px 15px;
        border-radius: 5px;
        text-decoration: none;
        color: #fff;
        margin-right: 10px;
        background-color: #CF6764; /* 기본 버튼 색상 */
        border: none; /* 테두리 제거 */
        transition: background-color 0.3s; /* 버튼 효과 */
    }

    .content-review .secondary_review {
         display: inline-block;
        padding: 10px 15px;
        border-radius: 5px;
        text-decoration: none;
        color: #fff;
        margin-right: 10px;
        background-color: #CF6764; /* 기본 버튼 색상 */
        border: none; /* 테두리 제거 */
        transition: background-color 0.3s; /* 버튼 효과 */
    }

    .btn:hover {
        background-color: #b03e3a; /* 버튼 호버 색상 */
    }

    /* 모달 스타일 */
    .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .modal-content p {
        margin-bottom: 15px;
        font-size: 1.1em;
    }
</style>

{% endblock %}
